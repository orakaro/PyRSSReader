<p>
Nowadays,
computers have so much memory that running out of RAM
is rarely the cause for an "out of memory" error.
</p>
<p>
Actually, let's try that again.
For over a decade,
<a href="http://ns1758.ca/winch/winchest.html">
hard drive have been so large</a>
(and
<a href="http://www.mkomo.com/cost-per-gigabyte">cheap</a>)
that running out of swap
space is rarely the cause for an "out of memory" error.
</p>
<p>
In user-mode, the term <i>memory</i>
<a href="http://blogs.msdn.com/b/ericlippert/archive/2009/06/08/out-of-memory-does-not-refer-to-physical-memory.aspx">
refers to virtual memory,
not physical RAM chips</a>.
The amount of physical RAM doesn't affect how much memory
a user-mode application can allocate;
it's all about commit and swap space.&sup1;
But swap space is disk space, and that is in the hundreds of
gigabytes for hard drives.
(Significantly less for SSDs, but even in that case, it's
far more than
4<a href="http://blogs.msdn.com/b/oldnewthing/archive/2009/06/11/9725386.aspx">GB</a>.)
</p>
<p>
The limiting factor these days is address space.
</p>
<p>
Each thread's stack takes a megabyte,
and if you're creating a lot of threads,
that can add up to a lot of address space consumed just for stacks.
And then you have to include the address space for the DLLs you've
loaded (which quickly adds up).
And then there's the address space for all the memory you allocated.
(Even if you don't end up using it, it still occupies address space
until you free it.)
</p>
<p>
Typically, when you get an
<code>ERROR_OUT_OF_MEMORY</code> error,
the problem isn't physical memory or virtual memory.
It's address space.
</p>
<p>
This is one of the main benefits of moving to 64-bit computing.
It's not that you actually are going to use or need all that memory.
But it relieves pressure on the address space:
The user-mode address space in 64-bit Windows is eight <i>terabytes</i>.
</p>
<p>
When the day comes that eight terabytes is not enough,
we at least won't have to redesign the application model
to expand the address space.
The current x86-64 hardware has support for address spaces of
up to 256TB, and
the theoretical address space for a 64-bit processor is
sixteen exabytes.
</p>
<p>
&sup1; Of course, physical RAM is a factor if
the application is explicitly allocating physical
memory, but that's the exception rather than the rule.
</p>
<p>
<b>Exercise</b>:
Help this customer clear up their confusion:
They reported that processes were failing to start with
<code>STATUS_DLL_INIT_FAILED</code> (0xC0000142),
and our diagnosis was that the
<a href="http://blogs.msdn.com/b/ntdebugging/archive/2007/01/04/desktop-heap-overview.aspx">
desktop heap</a>
was exhausted.
"The system has 8GB of RAM installed,
and Task Manager reports
that only 2GB of it is being used,
so it is unlikely that I am running out of any kind
of heap/memory."
<div style="clear: both;"></div><img height="1" src="http://blogs.msdn.com/aggbug.aspx?PostID=10429807" width="1" />